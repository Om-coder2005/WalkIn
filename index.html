<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WalkIn — Kolhapur Success Stories</title>
    <style>
      :root{
        --primary:#6c574c;
        --primary-light:#9e827a;
        --accent:#4e6758;
        --accent-light:#668673;
        --bg:#fbf9f4;
        --surface:#fefefe;
        --text:#30251f;
        --text-light:#5e534f;
        --muted:#8b7f75;
        --muted-light:#dcd5d0;
        --border:#c7bfba;
        --border-light:#e5e0dc;
        --shadow:0 1px 2px rgba(0,0,0,0.05), 0 2px 4px rgba(0,0,0,0.02);
        --shadow-lg:0 5px 15px rgba(0,0,0,0.08);
        --radius:10px;
        --radius-lg:16px;
        --radius-xl:24px;
        --ease:cubic-bezier(0.4, 0, 0.2, 1);
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }
      html, body { height: 100%; }
      body {
        font-family: 'Inter', sans-serif;
        color: var(--text);
        background: var(--bg) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><rect width="4" height="4" fill="%23fbf9f4"/><circle cx="2" cy="2" r="0.5" fill="%23e8e2d7"/></svg>') repeat;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-size: 15px;
      }
      .hand-drawn {
        font-family: 'Caveat', cursive;
        font-weight: 700;
      }
      a { color: inherit; text-decoration: none; transition: all 0.2s var(--ease); }
      button { font: inherit; transition: all 0.2s var(--ease); }
      .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
      nav {
        position: sticky;
        top: 0;
        z-index: 50;
        background: var(--surface);
        border-bottom: 1px solid var(--border-light);
      }
      .nav-wrap {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 72px;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 800;
        font-size: 1.5rem;
        color: var(--primary);
      }
      .logo-icon { width: 32px; height: 32px; stroke: var(--primary); stroke-width: 2; fill: none; }
      .nav-links { display: flex; gap: 32px; align-items: center; }
      .nav-links a {
        color: var(--muted);
        font-weight: 500;
        font-size: 15px;
        padding: 8px 0;
        position: relative;
      }
      .nav-links a:hover { color: var(--text); }
      .nav-links a::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--primary);
        transition: width 0.3s var(--ease);
      }
      .nav-links a:hover::after { width: 100%; }
      .nav-right { display: flex; align-items: center; gap: 16px; }
      .search { position: relative; }
      .search input {
        width: 300px;
        max-width: 280px;
        border: 1px solid var(--border);
        border-radius: 24px;
        padding: 12px 44px 12px 16px;
        outline: none;
        background: var(--bg);
        font-size: 14px;
        color: var(--text);
        transition: all 0.2s var(--ease);
      }
      .search input::placeholder { color: var(--muted-light); }
      .search input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--primary), 0 0 0 5px rgba(122, 98, 90, 0.2);
        transform: translateY(-1px);
      }
      .search-icon {
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--muted-light);
        width: 18px;
        height: 18px;
      }
      .btn {
        border: 2px solid var(--primary);
        border-radius: 24px;
        padding: 12px 24px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.2s var(--ease);
        position: relative;
        overflow: hidden;
        background: none;
      }
      .btn-primary {
        background: var(--primary);
        color: #fff;
        border-color: var(--primary);
      }
      .btn-primary:hover {
        background: var(--primary-light);
        color: #fff;
        border-color: var(--primary-light);
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
      }
      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .btn-ghost {
        background: transparent;
        color: var(--muted);
        border: 2px solid var(--border);
      }
      .btn-ghost:hover {
        background: var(--border-light);
        border-color: var(--primary-light);
        color: var(--primary);
      }
      .profile { position: relative; display: none; align-items: center; gap: 12px; cursor: pointer; }
      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 700;
        font-size: 16px;
        overflow: hidden;
      }
      .avatar img { width: 100%; height: 100%; object-fit: cover; }
      .dropdown {
        position: absolute;
        top: 52px;
        right: 0;
        background: var(--surface);
        border: 2px solid var(--border);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        min-width: 200px;
        display: none;
        flex-direction: column;
        overflow: hidden;
        animation: dropdownFade 0.2s var(--ease);
        z-index: 100;
      }
      @keyframes dropdownFade {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .dropdown a, .dropdown button {
        padding: 14px 16px;
        text-align: left;
        background: none;
        border: none;
        cursor: pointer;
        color: var(--muted);
        font-weight: 500;
        transition: all 0.2s var(--ease);
        width: 100%;
      }
      .dropdown a:hover, .dropdown button:hover {
        background: rgba(108, 87, 76, 0.05); 
        color: var(--primary);
      }
      .dropdown-separator {
        padding: 12px 16px;
        border-top: 1px dashed var(--border-light);
      }
      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 100%;
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--surface);
        font-size: 13px;
        margin-top: 4px;
        transition: all 0.2s var(--ease);
      }
      select:focus {
        outline: none;
        border-color: var(--primary);
      }
      .menu-toggle { display: none; }
      .menu-toggle button {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--muted);
        padding: 8px;
        border-radius: var(--radius);
      }
      .menu-toggle button:hover {
        background: var(--border-light);
        color: var(--text);
      }
      .hero {
        background: linear-gradient(135deg, var(--bg) 0%, var(--border-light) 100%);
        position: relative;
        overflow: hidden;
        border-bottom: 2px dashed var(--border);
      }
      .hero-wrap {
        padding: 100px 0 120px;
        text-align: center;
        position: relative;
        z-index: 2;
      }
      .hero-title-wrap {
          display: inline-block;
          position: relative;
          margin-bottom: 20px;
      }
      .hero-title-wrap h1 {
          font-size: 4rem;
          font-weight: 800;
          color: var(--text);
          margin: 0;
          position: relative;
          z-index: 2;
      }
      .scribble {
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        height: 30px;
        stroke: #c0392b;
        stroke-width: 2px;
        fill: none;
        z-index: 1;
        stroke-dasharray: 600;
        stroke-dashoffset: 600;
        animation: drawScribble 2s forwards 0.5s;
      }
      @keyframes drawScribble {
        to { stroke-dashoffset: 0; }
      }
      .hero p {
        max-width: 600px;
        margin: 0 auto 40px;
        color: var(--text-light);
        font-size: 18px;
        line-height: 1.7;
        position: relative;
      }
      .hero-actions {
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .section-title {
        text-align: center;
        margin: 60px 0 20px;
        font-size: 2rem;
        font-weight: 700;
        color: var(--text);
      }
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 24px;
        margin: 40px 0 80px;
      }
      .card {
        background: var(--surface);
        border: 2px solid var(--border);
        border-radius: var(--radius-xl);
        padding: 24px;
        box-shadow: none;
        transition: transform 0.3s var(--ease), box-shadow 0.3s var(--ease);
        position: relative;
        overflow: hidden;
      }
      .card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary);
      }
      .badge {
        display: inline-block;
        font-size: 12px;
        font-weight: 600;
        background: none;
        border: 1px dashed var(--muted);
        color: var(--muted);
        padding: 6px 12px;
        border-radius: 4px;
        text-transform: capitalize;
      }
      .card h3 {
        margin: 16px 0 8px;
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text);
      }
      .card p {
        color: var(--text-light);
        font-size: 14px;
        line-height: 1.6;
      }
      .price {
        margin-top: 16px;
        font-weight: 700;
        color: var(--accent);
        font-size: 1.1rem;
      }
      .story-quote {
        margin-top: 16px;
        font-style: italic;
        color: var(--primary);
        font-size: 15px;
        border-left: 3px solid var(--primary-light);
        padding-left: 12px;
      }
      .story-quote strong {
          display: block;
          margin-top: 8px;
          font-weight: 700;
          color: var(--text-light);
      }
      .empty {
        grid-column: 1/-1;
        text-align: center;
        color: var(--muted-light);
        padding: 60px 20px;
        font-size: 16px;
      }
      .backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
        -webkit-backdrop-filter: blur(4px);
        backdrop-filter: blur(4px);
        z-index: 9998;
      }
      .backdrop.show {
        display: flex;
        animation: backdropFade 0.3s var(--ease);
      }
      @keyframes backdropFade {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .modal {
        position: relative;
        max-width: 420px;
        width: 100%;
        background: var(--surface);
        border: 2px solid var(--border);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        animation: modalSlide 0.3s var(--ease);
        z-index: 9999;
      }
      @keyframes modalSlide {
        from { opacity: 0; transform: translateY(-20px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
      }
      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid var(--border-light);
      }
      .modal-header button {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--muted);
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s var(--ease);
      }
      .modal-header button:hover {
        background: var(--border-light);
        color: var(--text);
      }
      .modal-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text);
      }
      .modal-body { padding: 24px; }
      .tabs {
        display: flex;
        gap: 4px;
        background: var(--border-light);
        border-radius: var(--radius);
        padding: 4px;
        margin-bottom: 20px;
      }
      .tab {
        flex: 1;
        background: none;
        border: none;
        padding: 12px;
        border-radius: calc(var(--radius) - 2px);
        font-weight: 600;
        color: var(--muted);
        cursor: pointer;
        transition: all 0.2s var(--ease);
      }
      .tab[aria-selected="true"] {
        background: var(--surface);
        color: var(--text);
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      .form { display: none; }
      .form.active { display: block; }
      .field { margin: 16px 0; }
      .field label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text);
        font-size: 14px;
      }
      input[type="text"], input[type="email"], input[type="password"] {
        width: 100%;
        padding: 14px 16px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--surface);
        font-size: 14px;
        transition: all 0.2s var(--ease);
      }
      input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(108, 87, 76, 0.2);
      }
      /* New style for the hidden file input */
      input[type="file"] {
        display: none;
      }
      .image-upload-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        border: 1px dashed var(--border);
        border-radius: var(--radius);
        margin-bottom: 10px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .image-upload-area:hover {
        background: var(--border-light);
      }
      .image-upload-preview {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--muted-light);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--muted);
        font-size: 1.5rem;
        margin-bottom: 5px;
        overflow: hidden;
      }
      .image-upload-preview img { width: 100%; height: 100%; object-fit: cover; }
      .upload-text {
        font-size: 12px;
        color: var(--muted);
      }
      .form-actions { margin-top: 20px; }
      .btn-wide { width: 100%; }
      footer {
        border-top: 1px solid var(--border);
        background: var(--surface);
        padding: 40px 0;
        text-align: center;
        color: var(--muted);
      }
      /* Modified styles for the content tabs */
      .content-tabs {
          display: flex;
          justify-content: center;
          gap: 16px;
          margin: 40px 0 30px;
          /* Removed border-bottom for single title look */
      }
      .content-tab {
          background: none;
          border: none;
          padding: 12px 0; /* Adjusted padding */
          font-size: 1.25rem;
          font-weight: 600;
          cursor: default; /* Remove pointer for single static tab */
          color: var(--primary); /* Always active color */
          position: relative;
          transition: all 0.2s var(--ease);
      }
      .content-tab.hand-drawn {
          font-size: 2.5rem; /* Make the single title larger */
          padding-bottom: 8px;
          margin-top: 30px; /* Space it out more */
      }
      /* Remove all active tab styling artifacts */
      .content-tab[aria-selected="true"]::after {
          display: none;
      }

      @media (max-width: 960px) {
        .hero-title-wrap h1 { font-size: 2.8rem; }
        .hero-wrap { padding: 80px 0 100px; }
      }
      @media (max-width: 640px) {
        .nav-links { display: none; }
        .menu-toggle { display: block; }
        .search input { width: 200px; }
        .hero-title-wrap h1 { font-size: 2.2rem; }
        .hero p { font-size: 16px; }
        .hero-wrap { padding: 60px 0 80px; }
        .container { padding: 0 16px; }
        .section-title { margin: 40px 0 16px; }
        .cards { margin: 24px 0 60px; }
        .content-tab.hand-drawn { font-size: 1.8rem; margin-top: 20px; }
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="container nav-wrap">
            <a class="logo" href="#">
                <span class="hand-drawn">WalkIn</span>
            </a>
            <div class="nav-links" id="navLinks">
                <a href="home.html" data-i18n="nav_home">Home</a>
                <a href="explore.html" data-i18n="nav_explore">Explore</a>
                <a href="profile.html" data-i18n="nav_profile">Profile</a>
                <a href="contact.html" data-i18n="nav_contact">Contact</a> 
            </div>
            <div class="nav-right">
                <div class="search" style="display:none;">
                    <input id="searchInput" type="text" placeholder="Search stories…"/>
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <button class="btn btn-primary" id="authTrigger">Login / Signup</button>
                <div class="profile" id="profileBox">
                    <div class="avatar" id="navAvatar">K</div>
                    <strong id="profileName">User</strong>
                    <div class="dropdown" id="profileMenu">
                        <a href="profile.html">Profile</a>
                        <a href="explore.html">Explore</a>
                        <div class="dropdown-separator">
                            <label for="languageSelect">Language</label>
                            <select id="languageSelect">
                                <option value="en">English</option>
                                <option value="hi">हिन्दी (Hindi)</option>
                                <option value="mr">मराठी (Marathi)</option>
                            </select>
                        </div>
                        <button id="logoutBtn">Logout</button>
                    </div>
                </div>
                <div class="menu-toggle">
                    <button id="menuToggle">☰</button>
                </div>
            </div>
        </div>
    </nav>
    <header class="hero">
        <div class="container hero-wrap">
            <div class="hero-title-wrap">
                <h1 class="hand-drawn">WalkIn</h1>
                <svg class="scribble" viewBox="20 10 150 50" preserveAspectRatio="none">
              <path d="M5,30 C 70,30, 150,18, 185,20" />  
                    </div>
            <p data-i18n="hero_subtitle">Celebrating the successful connections made by Kolhapur's local talent.</p>
            <div class="hero-actions">
                <a class="btn btn-primary" href="#explore" data-i18n="hero_explore">View Success Stories</a>
                <button class="btn btn-ghost" id="authTriggerHero" data-i18n="hero_join">Share Your Story</button>
            </div>
        </div>
    </header>
    <main class="container" id="mainContent">
        <section id="explore">
            <div class="content-tabs">
                <h2 class="content-tab hand-drawn" id="tab-stories" aria-selected="true" data-i18n="tab_stories">
                    Success Stories
                </h2>
            </div>
            <div class="cards" id="contentCards"></div>
            </section>
    </main>
    <footer id="contact">
        <div class="container" data-i18n="footer">© 2025 WalkIn · Built in Kolhapur</div>
    </footer>
    <div class="backdrop" id="authBackdrop">
        <div class="modal" id="authModal">
            <div class="modal-header">
                <h3 class="modal-title hand-drawn">Welcome to WalkIn</h3>
                <button id="authClose">✕</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab" id="tab-login" aria-selected="true">Log in</button>
                    <button class="tab" id="tab-signup" aria-selected="false">Sign up</button>
                </div>
                <form class="form active" id="panel-login">
                    <div class="field">
                        <label>Email</label>
                        <input id="loginEmail" type="email" required/>
                    </div>
                    <div class="field">
                        <label>Password</label>
                        <input id="loginPassword" type="password" required/>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-wide">Log in</button>
                    </div>
                </form>
                <form class="form" id="panel-signup">
                    <div class="field">
                        <label>Username</label>
                        <input id="signupName" type="text" required/>
                    </div>
                    <div class="field">
                        <label>Email</label>
                        <input id="signupEmail" type="email" required/>
                    </div>
                    <div class="field">
                        <label>Password</label>
                        <input id="signupPassword" type="password" required minlength="6"/>
                    </div>
                    <div class="field">
                        <label>Profile Picture (Optional)</label>
                        <div class="image-upload-area" id="signupImageArea">
                            <div class="image-upload-preview" id="signupImagePreview">
                                <span>+</span>
                            </div>
                            <span class="upload-text">Click to select image</span>
                            <input type="file" id="signupImageUpload" accept="image/*"/>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-wide">Create account</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        // Firebase config
        const firebaseConfig = { 
            apiKey: "AIzaSyAOzsToiVP9BsevCDOjF54w341zIJghm_Y", 
            authDomain: "walkin-3c91d.firebaseapp.com", 
            projectId: "walkin-3c91d", 
            storageBucket: "walkin-3c91d.firebasestorage.app", 
            messagingSenderId: "145040800467", 
            appId: "1:145040800467:web:3075cc56710dd5eaef7226", 
            measurementId: "G-1EK3FBEBH7" 
        };

        const app = initializeApp(firebaseConfig);
        getAnalytics(app);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Global state for signup image
        let signupImageFile = null;

        // Helper functions
        const qs = s => document.querySelector(s);
        const qsa = s => document.querySelectorAll(s);

        // DOM elements
        const profileBox = qs("#profileBox");
        const profileMenu = qs("#profileMenu");
        const profileName = qs("#profileName");
        const navAvatar = qs("#navAvatar");
        const logoutBtn = qs("#logoutBtn");
        const backdrop = qs("#authBackdrop");
        const modal = qs("#authModal");
        const closeBtn = qs("#authClose");
        const authTrigger = qs("#authTrigger");
        const authTriggerHero = qs("#authTriggerHero");
        const signupForm = qs("#panel-signup");
        const signupImageUpload = qs("#signupImageUpload");
        const signupImageArea = qs("#signupImageArea");
        const signupImagePreview = qs("#signupImagePreview");
        
        // --- NEW DOM ELEMENTS ---
        const searchInput = qs("#searchInput"); // Kept for logic, but hidden in HTML/CSS
        const contentCards = qs("#contentCards");
        // --- END NEW DOM ELEMENTS ---


        // Tab switching (Auth Modal)
        const tabs = qsa('.tab');
        const forms = qsa('.form');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.id.replace('tab-', 'panel-');
                tabs.forEach(t => t.setAttribute('aria-selected', 'false'));
                forms.forEach(f => f.classList.remove('active'));
                tab.setAttribute('aria-selected', 'true');
                qs(`#${target}`).classList.add('active');
            });
        });

        // Auth modal controls
        function openAuth(view = "login") { 
            backdrop.classList.add("show");
            if (view === "signup") {
                qs("#tab-signup").click();
            } else {
                qs("#tab-login").click();
            }
        }
        
        function closeAuth() { 
            backdrop.classList.remove("show");
            // Reset forms
            qs("#panel-login").reset();
            qs("#panel-signup").reset();
            signupImageFile = null; // Reset image file
            signupImagePreview.innerHTML = '<span>+</span>'; // Reset preview
        }

        authTrigger.addEventListener('click', () => {
            if (!auth.currentUser) openAuth("login");
        });

        if (authTriggerHero) {
            authTriggerHero.addEventListener('click', () => {
                if (!auth.currentUser) openAuth("signup");
            });
        }

        closeBtn.addEventListener('click', closeAuth);
        backdrop.addEventListener('click', (e) => { 
            if (e.target === backdrop) closeAuth(); 
        });
        
        // Image Selection Handlers
        signupImageArea.addEventListener('click', () => signupImageUpload.click());
        signupImageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                signupImageFile = file;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    signupImagePreview.innerHTML = `<img src="${ev.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });


        // Loading state helper
        function setFormLoading(formElement, loading, message = 'Please wait...') {
            const btn = formElement.querySelector('button[type="submit"]');
            const inputs = formElement.querySelectorAll('input');
            
            if (loading) {
                btn.textContent = message;
                btn.disabled = true;
                inputs.forEach(input => input.disabled = true);
            } else {
                btn.textContent = formElement.id === 'panel-login' ? 'Log in' : 'Create account';
                btn.disabled = false;
                inputs.forEach(input => input.disabled = false);
            }
        }

        // --- NEW FUNCTION TO HANDLE UPLOAD VIA GENERIC SERVER (COPIED FROM PROFILE.HTML) ---
        async function uploadImageViaCustomServer(file, uid) {
            const uploadUrl = 'http://localhost:3000/api/upload-profile-image'; 

            const formData = new FormData();
            formData.append('profileImage', file); 
            formData.append('userId', uid); 

            try {
                const response = await fetch(uploadUrl, {
                    method: 'POST',
                    body: formData, 
                });

                if (!response.ok) {
                    const errorData = await response.json(); 
                    throw new Error(errorData.message || `Server responded with status ${response.status}`);
                }

                const data = await response.json();
                return data.url; 
                
            } catch (error) {
                throw new Error(`Image upload failed: ${error.message}`);
            }
        }
        // --- END NEW FUNCTION ---


        // Sign up handler
        signupForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const name = qs("#signupName").value.trim();
            const email = qs("#signupEmail").value.trim();
            const pw = qs("#signupPassword").value.trim();

            if (!name || !email || !pw) {
                alert("⚠️ Please fill all fields");
                return;
            }

            if (pw.length < 6) {
                alert("⚠️ Password must be at least 6 characters");
                return;
            }

            setFormLoading(signupForm, true, 'Creating user...');
            let profileImageURL = null; // Initialize image URL

            try {
                // 1. Create user account with Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, pw);
                const user = userCredential.user;

                // 2. Handle Image Upload (if file exists)
                if (signupImageFile) {
                    setFormLoading(signupForm, true, 'Uploading image...');
                    // Use the custom server function
                    profileImageURL = await uploadImageViaCustomServer(signupImageFile, user.uid);
                }

                // 3. Update profile with display name
                await updateProfile(user, { displayName: name, photoURL: profileImageURL });

                // 4. Save initial data to Firestore
                setFormLoading(signupForm, true, 'Saving profile...');
                await setDoc(doc(db, "profiles", user.uid), {
                    name: name,
                    email: email,
                    role: "jobseeker",
                    createdAt: serverTimestamp(),
                    profileImageURL: profileImageURL // Save the URL from the custom server
                });

                alert("✅ Account created successfully! Welcome, " + name);
                closeAuth();
            } catch (err) {
                console.error("Signup error:", err);
                if (err.code === "auth/email-already-in-use") {
                    alert("❌ This email is already registered. Try logging in instead.");
                } else if (err.code === "auth/invalid-email") {
                    alert("❌ Please enter a valid email address.");
                } else if (err.code === "auth/weak-password") {
                    alert("❌ Password is too weak. Use at least 6 characters.");
                } else if (err.message.includes("Image upload failed")) {
                     alert("❌ Signup failed: Could not upload image. Check your custom server logs.");
                } else {
                    alert("❌ Error: " + err.message);
                }
            } finally {
                setFormLoading(signupForm, false);
            }
        });

        // Login handler
        qs("#panel-login").addEventListener("submit", async (e) => {
            // ... (login handler remains the same)
            e.preventDefault();
            
            const email = qs("#loginEmail").value.trim();
            const pw = qs("#loginPassword").value.trim();

            if (!email || !pw) {
                alert("⚠️ Please fill all fields");
                return;
            }

            const form = qs("#panel-login");
            setFormLoading(form, true);

            try {
                await signInWithEmailAndPassword(auth, email, pw);
                alert("✅ Welcome back to WalkIn!");
                closeAuth();
            } catch (err) {
                console.error("Login error:", err);
                if (err.code === "auth/user-not-found") {
                    alert("❌ No account found with this email. Please sign up first.");
                } else if (err.code === "auth/wrong-password") {
                    alert("❌ Incorrect password. Please try again.");
                } else if (err.code === "auth/invalid-credential") {
                    alert("❌ Invalid email or password. Please check and try again.");
                } else {
                    alert("❌ Error: " + err.message);
                }
            } finally {
                setFormLoading(form, false);
            }
        });

        // Logout handler
        logoutBtn.addEventListener("click", async () => {
            // ... (logout handler remains the same)
            try {
                await signOut(auth);
                alert("👋 Logged out successfully");
                profileMenu.style.display = "none";
            } catch (err) {
                console.error("Logout error:", err);
                alert("❌ Error logging out: " + err.message);
            }
        });

        // Auth state observer (Updated to check for photoURL)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                authTrigger.style.display = "none";
                profileBox.style.display = "flex";

                try {
                    const profileRef = doc(db, "profiles", user.uid);
                    const profileSnap = await getDoc(profileRef);

                    let displayName, imageURL;

                    if (profileSnap.exists()) {
                        const profile = profileSnap.data();
                        displayName = profile.name;
                        imageURL = profile.profileImageURL;
                    } else {
                        displayName = user.displayName || user.email.split("@")[0];
                        imageURL = user.photoURL; // Fallback to auth photoURL
                    }

                    profileName.textContent = displayName;
                    const initial = displayName ? displayName[0].toUpperCase() : 'U';
                    
                    if (imageURL) {
                        navAvatar.innerHTML = `<img src="${imageURL}" alt="P">`;
                    } else {
                        navAvatar.innerHTML = `<span>${initial}</span>`;
                    }

                } catch (err) {
                    console.error("Error fetching profile:", err);
                    const displayName = user.displayName || user.email.split("@")[0];
                    profileName.textContent = displayName;
                    navAvatar.innerHTML = `<span>${displayName[0].toUpperCase()}</span>`;
                }
            } else {
                authTrigger.style.display = "inline-block";
                profileBox.style.display = "none";
            }
        });

        // Profile dropdown toggle
        profileBox.addEventListener("click", (e) => {
            if (e.target.closest("#languageSelect")) return;
            const isOpen = profileMenu.style.display === "flex";
            profileMenu.style.display = isOpen ? "none" : "flex";
            profileBox.setAttribute("aria-expanded", String(!isOpen));
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!profileBox.contains(e.target)) {
                profileMenu.style.display = 'none';
                profileBox.setAttribute("aria-expanded", "false");
            }
        });

        // Translations (Updated to remove services translation and adjust hero text)
        const translations = {
            en: {
                nav_home: "Home",
                nav_explore: "Explore",
                nav_profile: "Profile",
                nav_contact: "Contact",
                hero_subtitle: "Celebrating the successful connections made by Kolhapur's local talent.",
                hero_explore: "View Success Stories",
                hero_join: "Share Your Story",
                tab_stories: "Success Stories",
                footer: "© 2025 WalkIn · Built in Kolhapur"
            },
            hi: {
                nav_home: "होम",
                nav_explore: "खोजें",
                nav_profile: "प्रोफ़ाइल",
                nav_contact: "संपर्क",
                hero_subtitle: "कोल्हापुर की स्थानीय प्रतिभा द्वारा किए गए सफल कनेक्शन का जश्न मनाना।",
                hero_explore: "सफलता की कहानियाँ देखें",
                hero_join: "अपनी कहानी साझा करें",
                tab_stories: "सफलता की कहानियाँ",
                footer: "© 2025 वॉकइन · कोल्हापुर में निर्मित"
            },
            mr: {
                nav_home: "मुख्यपृष्ठ",
                nav_explore: "एक्सप्लोर",
                nav_profile: "प्रोफाइल",
                nav_contact: "संपर्क",
                hero_subtitle: "कोल्हापूरच्या स्थानिक कलागुणांनी केलेल्या यशस्वी जोडण्यांचा उत्सव.",
                hero_explore: "यशाच्या कथा पहा",
                hero_join: "तुमची कथा सांगा",
                tab_stories: "यशाच्या कथा",
                footer: "© 2025 वॉकइन · कोल्हापुरमध्ये तयार केले"
            }
        };

        function translateUI(lang) {
            const t = translations[lang] || translations.en;
            document.querySelectorAll("[data-i18n]").forEach(el => {
                const key = el.getAttribute("data-i18n");
                if (t[key]) el.textContent = t[key];
            });
        }

        // Language selector
        const languageSelect = qs("#languageSelect");
        let currentLang = "en";
        languageSelect.value = currentLang;
        translateUI(currentLang);

        languageSelect.addEventListener("change", () => {
            currentLang = languageSelect.value;
            translateUI(currentLang);
        });

        // Removed jobs array

        const successStories = [
            { id: 7, type: "story", category: "Entrepreneurship", title: "From Hobby to Business", name: "Sushma Rane", quote: "WalkIn gave me the confidence and platform to turn my stitching hobby into a full-time, profitable tailoring business right from my home in Shahupuri. Highly recommend!" },
            {  id: 11, type: "story", category: "Training & Skill Development", title: "छोटे शहर में बड़ा काम", name: "आदित्य शर्मा", quote: "मैंने सोचा नहीं था कि कोल्हापुर जैसे शहर में मुझे ऑनलाइन ग्राफिक्स का काम मिल पाएगा। WalkIn पर अपनी प्रोफाइल बनाने के कुछ ही हफ्तों में मुझे दो बेहतरीन क्लाइंट मिले और अब मेरी आय दोगुनी हो गई है। यह मेरे लिए एक बड़ी जीत है!"} ,         
            { id: 12, type: "story", category: "Home Services", title: "घरासाठी त्वरित आणि विश्वासार्ह मदत ", name: "सुजाता गायकवाड ", quote: "घरातील लहानसहान दुरुस्तीसाठी चांगला कारागीर शोधण्यात खूप वेळ जायचा. WalkIn मुळे मला एका क्लिकवर त्वरित आणि विश्‍वासार्ह हँडीमॅन मिळाला. माझा वेळ आणि श्रम दोन्ही वाचले. ही सेवा खरंच खूप उपयुक्त आहे!" }        ];
        
        // State for current view is now permanently "stories"
        let currentView = "stories";

        // Render card function (Now only handles stories)
        function renderCards(list, viewType) {
            contentCards.innerHTML = '';
            
            // The search bar is now globally hidden in CSS and HTML structure, 
            // but if it were visible, this is where we'd hide it.
            if (searchInput) {
                 qs(".search").style.display = "none";
                 searchInput.value = ''; // Clear search input
            }
            
            if (list.length === 0) {
                contentCards.innerHTML = '<div class="empty">No inspiring stories yet! Be the first to share yours.</div>';
                return;
            }
            
            list.forEach(s => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                    <span class="badge">${s.category}</span>
                    <h3>${s.title}</h3>
                    <p class="story-quote">“${s.quote}” 
                        <strong>— ${s.name}</strong>
                    </p>
                `;
                contentCards.appendChild(card);
            });
        }

        // Initial render: Display only Success Stories
        renderCards(successStories, "stories");

        // Search functionality is removed as the primary content (Services) is gone.
        // Keeping a placeholder function for stability, but it's not strictly necessary.
        if (searchInput) {
            searchInput.addEventListener("input", (e) => {
                const query = e.target.value.toLowerCase().trim();
                
                // Although the search bar is hidden, if it were to be used:
                if (currentView === "stories") {
                    const filtered = successStories.filter(story =>
                        story.title.toLowerCase().includes(query) ||
                        story.quote.toLowerCase().includes(query) ||
                        story.category.toLowerCase().includes(query) ||
                        story.name.toLowerCase().includes(query)
                    );
                    renderCards(filtered, "stories");
                }
            });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        console.log("✅ WalkIn (Success Stories only) initialized successfully");
    </script>
</body>
</html>
